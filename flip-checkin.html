<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flip Clock + Check-in</title>

  <!-- Flip-clock friendly font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: transparent;

      --card: rgba(255,255,255,0.92);
      --edge: rgba(0,0,0,0.10);
      --hinge: rgba(0,0,0,0.10);

      --text: #0b0b0b;
      --muted: rgba(0,0,0,0.55);

      --shadow: 0 18px 45px rgba(0,0,0,0.12);

      --btnBg: rgba(255,255,255,0.92);
      --btnBorder: rgba(0,0,0,0.16);
      --btnText: #0b0b0b;
      --btnHover: rgba(255,255,255,0.98);

      /* Size controls */
      --digitW: clamp(120px, 16vw, 230px);
      --digitH: clamp(160px, 22vw, 300px);
      --radius: clamp(18px, 2.2vw, 26px);
      --gap: clamp(12px, 1.8vw, 18px);
      --colon: clamp(42px, 6vw, 86px);
      --num: clamp(92px, 12vw, 170px);
    }

    @media (prefers-color-scheme: dark){
      :root{
        --card: rgba(20,20,20,0.92);
        --edge: rgba(255,255,255,0.12);
        --hinge: rgba(255,255,255,0.12);

        --text: rgba(255,255,255,0.96);
        --muted: rgba(255,255,255,0.62);

        --shadow: 0 24px 60px rgba(0,0,0,0.55);

        --btnBg: rgba(20,20,20,0.92);
        --btnBorder: rgba(255,255,255,0.18);
        --btnText: rgba(255,255,255,0.96);
        --btnHover: rgba(26,26,26,0.96);
      }
    }

    html, body{
      width:100%;
      height:100%;
      margin:0;
      background: var(--bg);
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    /* Intentional whitespace */
    .stage{
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 26px;
      box-sizing:border-box;
    }

    .wrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 18px;
      user-select:none;
    }

    .clockRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: var(--gap);
    }

    .colon{
      font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: var(--colon);
      line-height: 1;
      opacity: 0.6;
      transform: translateY(-2px);
    }

    /* Digit container */
    .digit{
      width: var(--digitW);
      height: var(--digitH);
      position: relative;
      perspective: 1200px;
      filter: drop-shadow(var(--shadow));
    }

    .shell{
      position:absolute;
      inset:0;
      border-radius: var(--radius);
      background: var(--card);
      border: 1px solid var(--edge);
      overflow:hidden;
    }

    /* subtle vignette like classic flip cards */
    .shell::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(120% 90% at 50% 18%, rgba(255,255,255,0.12), rgba(255,255,255,0) 55%),
        radial-gradient(120% 90% at 50% 90%, rgba(0,0,0,0.06), rgba(0,0,0,0) 60%);
      pointer-events:none;
      mix-blend-mode: normal;
      opacity: 0.9;
    }

    .hinge{
      position:absolute;
      left:0; right:0;
      top:50%;
      height:1px;
      background: var(--hinge);
      opacity: 0.9;
      transform: translateY(-0.5px);
      pointer-events:none;
    }

    /* Each half */
    .half{
      position:absolute;
      left:0; right:0;
      height:50%;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: "Roboto Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-weight: 700;
      font-variant-numeric: tabular-nums;
      letter-spacing: -0.02em;
      font-size: var(--num);
      line-height: 1;
      backface-visibility:hidden;
    }

    /* The number itself is perfectly centred in the full card, then clipped by the half */
    .num{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%, -50%);
      will-change: transform;
    }

    .top{
      top:0;
      background: linear-gradient(to bottom, rgba(255,255,255,0.10), rgba(0,0,0,0.04));
    }

    .bottom{
      bottom:0;
      background: linear-gradient(to top, rgba(255,255,255,0.06), rgba(0,0,0,0.06));
    }

    /* Animated halves */
    .flipTop{
      top:0;
      transform-origin: bottom;
      transform: rotateX(0deg);
      z-index: 4;
    }

    .flipBottom{
      bottom:0;
      transform-origin: top;
      transform: rotateX(90deg);
      z-index: 3;
    }

    /* add a bit of depth during flip */
    .flipTop::after, .flipBottom::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity 120ms ease;
    }

    .flipTop::after{
      background: linear-gradient(to bottom, rgba(0,0,0,0.18), rgba(0,0,0,0));
    }

    .flipBottom::after{
      background: linear-gradient(to top, rgba(0,0,0,0.18), rgba(0,0,0,0));
    }

    .digit.flipping .flipTop{ animation: flipTop 420ms ease-in forwards; }
    .digit.flipping .flipBottom{ animation: flipBottom 420ms ease-out forwards; }

    .digit.flipping .flipTop::after,
    .digit.flipping .flipBottom::after{
      opacity: 1;
    }

    @keyframes flipTop{
      0%   { transform: rotateX(0deg); }
      100% { transform: rotateX(-90deg); }
    }

    @keyframes flipBottom{
      0%   { transform: rotateX(90deg); }
      100% { transform: rotateX(0deg); }
    }

    /* Controls */
    .controls{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      min-height: 66px;
    }

    button{
      appearance:none;
      border: 1px solid var(--btnBorder);
      background: var(--btnBg);
      color: var(--btnText);
      border-radius: 999px;
      padding: 10px 16px;
      font-weight: 650;
      letter-spacing: 0.01em;
      cursor:pointer;
      transition: transform 120ms ease, background 120ms ease, border-color 120ms ease;
    }

    button:hover{
      background: var(--btnHover);
      border-color: color-mix(in srgb, var(--btnBorder) 70%, transparent);
    }

    button:active{ transform: scale(0.98); }

    .lastSeen{
      font-size: 13px;
      color: var(--muted);
      text-align:center;
      max-width: 520px;
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="wrap">
      <div class="clockRow" aria-label="Clock">
        <div class="digit" id="h1"></div>
        <div class="digit" id="h2"></div>
        <div class="colon">:</div>
        <div class="digit" id="m1"></div>
        <div class="digit" id="m2"></div>
      </div>

      <div class="controls">
        <button id="checkInBtn" type="button">Check in</button>
        <div class="lastSeen" id="lastSeen">Last seen: not checked in yet</div>
      </div>
    </div>
  </div>

<script>
  // ---------- Helpers ----------
  function pad2(n){ return String(n).padStart(2, "0"); }

  function sameDay(a, b){
    return a.getFullYear() === b.getFullYear()
      && a.getMonth() === b.getMonth()
      && a.getDate() === b.getDate();
  }

  function formatLastSeen(ts){
    const now = new Date();
    const d = new Date(ts);

    const time = d.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });

    const yesterday = new Date(now);
    yesterday.setDate(now.getDate() - 1);

    if (sameDay(d, now)) return `Last seen: today ${time}`;
    if (sameDay(d, yesterday)) return `Last seen: yesterday ${time}`;

    const date = d.toLocaleDateString([], { day: "2-digit", month: "short", year: "numeric" });
    return `Last seen: ${date} ${time}`;
  }

  // Optional: unique per page/client via URL: ?id=todenham
  const params = new URLSearchParams(location.search);
  const widgetId = params.get("id") || "default";
  const storageKey = `notion_flip_clock_checkin_${widgetId}`;

  // ---------- Flip Digit ----------
  function createDigit(el, initialChar){
    el.innerHTML = `
      <div class="shell"></div>
      <div class="hinge"></div>

      <div class="half top"><div class="num">${initialChar}</div></div>
      <div class="half bottom"><div class="num">${initialChar}</div></div>

      <div class="half flipTop"><div class="num">${initialChar}</div></div>
      <div class="half flipBottom"><div class="num">${initialChar}</div></div>
    `;
    el.dataset.current = initialChar;
  }

  function setDigit(el, nextChar){
    const current = el.dataset.current;
    if (current === nextChar) return;

    const topNum = el.querySelector(".top .num");
    const bottomNum = el.querySelector(".bottom .num");
    const flipTopNum = el.querySelector(".flipTop .num");
    const flipBottomNum = el.querySelector(".flipBottom .num");

    // Static halves show current until animation completes
    topNum.textContent = current;
    bottomNum.textContent = current;

    // Animated: flipTop shows current -> flips away
    //          flipBottom starts hidden at 90deg -> flips to next
    flipTopNum.textContent = current;
    flipBottomNum.textContent = nextChar;

    el.classList.remove("flipping");
    void el.offsetWidth; // reflow restart animation
    el.classList.add("flipping");

    setTimeout(() => {
      topNum.textContent = nextChar;
      bottomNum.textContent = nextChar;
      el.dataset.current = nextChar;
      el.classList.remove("flipping");
    }, 430);
  }

  // ---------- Init ----------
  const els = {
    h1: document.getElementById("h1"),
    h2: document.getElementById("h2"),
    m1: document.getElementById("m1"),
    m2: document.getElementById("m2"),
  };

  Object.values(els).forEach(el => createDigit(el, "0"));

  function tick(){
    const now = new Date();
    const hh = pad2(now.getHours());
    const mm = pad2(now.getMinutes());

    setDigit(els.h1, hh[0]);
    setDigit(els.h2, hh[1]);
    setDigit(els.m1, mm[0]);
    setDigit(els.m2, mm[1]);
  }

  tick();
  setInterval(tick, 1000);

  // ---------- Check-in ----------
  const lastSeenEl = document.getElementById("lastSeen");
  const btn = document.getElementById("checkInBtn");

  function refreshLastSeen(){
    const ts = localStorage.getItem(storageKey);
    lastSeenEl.textContent = ts ? formatLastSeen(Number(ts)) : "Last seen: not checked in yet";
  }

  btn.addEventListener("click", () => {
    const ts = Date.now();
    localStorage.setItem(storageKey, String(ts));
    refreshLastSeen();
  });

  refreshLastSeen();
</script>
</body>
</html>
